# v16

## 需求

SuperTrend = 绿 允许 BUY

## 实现方案

1. 新增 `supertrend/` 模块, 实现 SuperTrend 指标计算与币安数据封装.
2. 在 `order_builder` 增加 `SUPER_TREND_GUARD_ENABLED` 与 `SUPER_TREND_TIMEFRAME` 配置, 守护逻辑集中实现.
3. BUY 流程新增 SuperTrend 校验, 与 DeMark/RSI 一起防护, 并复用单次查询的信号.
4. SuperTrend 绿保留最小利润阈值, 非绿将 SELL 最低利润强制为 0.4, 加速出场.
5. 补充 SuperTrend 指标与守护相关测试, 确保绿灯放行, 非绿阻断.

## 测试

### 1m SuperTrend 15m

1m 新最大值: 2981.652170 USDC (之前: 2975.446670), 本地时间: 2024-09-07 08:21:00 CST
1m 新最大值: 3354.041200 USDC (之前: 3353.235810), 本地时间: 2025-02-10 09:44:00 CST
1m 新最大值: 3656.905050 USDC (之前: 3646.260620), 本地时间: 2025-04-09 19:41:00 CST

| Month   | Transactions | Gross Revenue | Fees    | Net Revenue |
| ------- | ------------ | ------------- | ------- | ----------- |
| 2025-09 | 158          | $12.33        | $2.97   | $9.36       |
| 2025-08 | 1379         | $159.61       | $35.73  | $123.88     |
| 2025-07 | 1231         | $128.40       | $29.74  | $98.65      |
| 2025-06 | 575          | $41.78        | $9.47   | $32.31      |
| 2025-05 | 1014         | $94.99        | $23.04  | $71.95      |
| 2025-04 | 979          | $108.31       | $21.43  | $86.89      |
| 2025-03 | 1390         | $453.32       | $50.13  | $403.19     |
| 2025-02 | 1349         | $169.51       | $34.84  | $134.67     |
| 2025-01 | 2067         | $237.53       | $58.87  | $178.66     |
| 2024-12 | 2024         | $291.69       | $71.14  | $220.55     |
| 2024-11 | 2681         | $620.00       | $128.29 | $491.71     |
| 2024-10 | 438          | $32.92        | $7.44   | $25.49      |
| 2024-09 | 492          | $38.42        | $8.13   | $30.29      |
| 2024-08 | 675          | $62.57        | $12.79  | $49.78      |
| 2024-07 | 761          | $68.06        | $14.94  | $53.13      |
| 2024-06 | 472          | $35.37        | $8.10   | $27.28      |
| 2024-05 | 676          | $57.61        | $13.27  | $44.33      |
| 2024-04 | 1114         | $100.69       | $25.07  | $75.62      |
| 2024-03 | 2083         | $211.26       | $59.42  | $151.85     |
| 2024-02 | 1527         | $148.44       | $41.30  | $107.14     |
| 2024-01 | 1008         | $363.23       | $42.89  | $320.34     |

    24093

$3436.07
$699.00
$2737.07

### SuperTrend 5m; RED 0.4% sell, 否则 1.4%

1m 新最大值: 3528.839710 USDC (之前: 3496.160750), 本地时间: 2025-07-02 04:04:00 CST

| Month   | Transactions | Gross Revenue | Fees   | Net Revenue |
| ------- | ------------ | ------------- | ------ | ----------- |
| 2025-09 | 80           | $9.21         | $1.39  | $7.82       |
| 2025-08 | 571          | $105.19       | $14.08 | $91.11      |
| 2025-07 | 454          | $99.50        | $11.45 | $88.05      |
| 2025-06 | 253          | $31.80        | $4.29  | $27.51      |
| 2025-05 | 422          | $66.37        | $9.41  | $56.96      |
| 2025-04 | 375          | $76.16        | $8.49  | $67.66      |
| 2025-03 | 650          | $424.45       | $27.00 | $397.45     |
| 2025-02 | 568          | $140.80       | $16.10 | $124.71     |
| 2025-01 | 905          | $203.00       | $26.66 | $176.33     |
| 2024-12 | 915          | $285.90       | $34.96 | $250.94     |
| 2024-11 | 1151         | $472.04       | $52.05 | $419.98     |
| 2024-10 | 233          | $24.04        | $3.71  | $20.33      |
| 2024-09 | 218          | $30.23        | $3.59  | $26.64      |
| 2024-08 | 321          | $44.99        | $6.15  | $38.84      |
| 2024-07 | 324          | $42.70        | $5.59  | $37.11      |
| 2024-06 | 236          | $25.43        | $3.87  | $21.56      |
| 2024-05 | 313          | $42.14        | $6.09  | $36.06      |
| 2024-04 | 548          | $68.16        | $12.08 | $56.08      |
| 2024-03 | 892          | $163.91       | $27.22 | $136.69     |
| 2024-02 | 648          | $89.61        | $15.80 | $73.81      |
| 2024-01 | 559          | $362.63       | $29.13 | $333.50     |

    10636

$2808.26
$319.12
$2489.14

### SuperTrend 15m; RED 0.4% sell, 否则 0.8%

1m 新最大值: 3656.284950 USDC (之前: 3624.298180), 本地时间: 2025-04-09 19:41:00 CST

| Month   | Transactions | Gross Revenue | Fees   | Net Revenue |
| ------- | ------------ | ------------- | ------ | ----------- |
| 2025-09 | 82           | $10.72        | $1.72  | $9.00       |
| 2025-08 | 899          | $149.38       | $24.29 | $125.10     |
| 2025-07 | 709          | $123.37       | $19.47 | $103.90     |
| 2025-06 | 379          | $37.01        | $6.45  | $30.56      |
| 2025-05 | 617          | $90.58        | $15.37 | $75.21      |
| 2025-04 | 579          | $96.37        | $13.63 | $82.74      |
| 2025-03 | 886          | $437.18       | $37.17 | $400.01     |
| 2025-02 | 862          | $164.75       | $22.99 | $141.77     |
| 2025-01 | 1364         | $236.16       | $41.08 | $195.08     |
| 2024-12 | 1349         | $305.84       | $51.59 | $254.25     |
| 2024-11 | 1896         | $646.83       | $96.68 | $550.16     |
| 2024-10 | 260          | $30.29        | $4.69  | $25.60      |
| 2024-09 | 269          | $34.06        | $4.84  | $29.22      |
| 2024-08 | 370          | $52.35        | $7.62  | $44.74      |
| 2024-07 | 435          | $58.76        | $9.01  | $49.75      |
| 2024-06 | 287          | $28.76        | $4.84  | $23.93      |
| 2024-05 | 405          | $52.17        | $8.60  | $43.57      |
| 2024-04 | 651          | $82.15        | $15.38 | $66.77      |
| 2024-03 | 1282         | $192.71       | $38.12 | $154.59     |
| 2024-02 | 996          | $139.39       | $27.63 | $111.76     |
| 2024-01 | 666          | $363.09       | $33.85 | $329.24     |

    15243

$3331.92
$484.99
$2846.93

收益有了突破

#### 同前, BUY_FROM_COMPARE_KLINES=False

收益不错, 但是资金占用太高了,没必要测试完毕了

1m 新最大值: 6208.014900 USDC (之前: 6130.899250), 本地时间: 2024-08-06 03:19:00 CST

| Month   | Transactions | Gross Revenue | Fees    | Net Revenue |
| ------- | ------------ | ------------- | ------- | ----------- |
| 2024-11 | 1905         | $895.83       | $126.67 | $769.17     |
| 2024-10 | 271          | $63.95        | $10.36  | $53.59      |
| 2024-09 | 277          | $60.80        | $8.81   | $51.98      |
| 2024-08 | 388          | $131.51       | $17.84  | $113.67     |
| 2024-07 | 440          | $136.18       | $18.23  | $117.95     |
| 2024-06 | 293          | $74.68        | $13.08  | $61.60      |
| 2024-05 | 411          | $85.54        | $14.34  | $71.20      |
| 2024-04 | 661          | $267.08       | $46.22  | $220.86     |
| 2024-03 | 1302         | $376.33       | $72.14  | $304.19     |
| 2024-02 | 995          | $215.91       | $42.39  | $173.52     |
| 2024-01 | 686          | $592.81       | $67.50  | $525.31     |

#### 同前, 限定 最多按 1% 买入

第一个月只有 173.28 不用测试了

#### 同前, 限定 最多按 4% 买入

第一个月 324.63, 不用测试了

#### 同前, SuperTrend 4h

收益还可以,但是资金占用依然迅速飙起来了

中间会有很多空档无交易的天,应该就是持续下跌被隔离的

1m 新最大值: 6019.356410 USDC (之前: 5971.966930), 本地时间: 2024-08-16 22:53:00 CST

| Month   | Transactions | Gross Revenue | Fees   | Net Revenue |
| ------- | ------------ | ------------- | ------ | ----------- |
| 2024-09 | 278          | $67.16        | $8.95  | $58.21      |
| 2024-08 | 190          | $89.77        | $12.47 | $77.30      |
| 2024-07 | 568          | $120.51       | $17.04 | $103.47     |
| 2024-06 | 247          | $65.00        | $11.66 | $53.34      |
| 2024-05 | 364          | $69.61        | $10.81 | $58.80      |
| 2024-04 | 443          | $323.75       | $56.05 | $267.70     |
| 2024-03 | 1081         | $368.75       | $65.26 | $303.49     |
| 2024-02 | 1239         | $252.28       | $47.17 | $205.10     |
| 2024-01 | 584          | $516.54       | $62.67 | $453.87     |

#### 双重检查 SuperTrend 1D 15m

1m 新最大值: 6039.801370 USDC (之前: 5950.027650), 本地时间: 2024-11-05 05:44:00 CST

| Month   | Transactions | Gross Revenue | Fees    | Net Revenue |
| ------- | ------------ | ------------- | ------- | ----------- |
| 2025-09 | 80           | $16.35        | $2.43   | $13.92      |
| 2025-08 | 595          | $175.48       | $26.27  | $149.20     |
| 2025-07 | 585          | $204.09       | $29.50  | $174.59     |
| 2025-06 | 120          | $35.66        | $7.09   | $28.58      |
| 2025-05 | 570          | $148.46       | $22.56  | $125.90     |
| 2025-04 | 353          | $127.32       | $15.41  | $111.92     |
| 2025-03 | 773          | $519.62       | $54.67  | $464.95     |
| 2025-02 | 17           | $0.34         | $0.72   | $-0.37      |
| 2025-01 | 1054         | $358.32       | $56.40  | $301.92     |
| 2024-12 | 1301         | $522.14       | $77.04  | $445.09     |
| 2024-11 | 1857         | $1013.58      | $135.21 | $878.37     |
| 2024-10 | 64           | $36.61        | $5.99   | $30.61      |
| 2024-09 | 67           | $21.32        | $2.76   | $18.56      |
| 2024-08 | 31           | $7.46         | $2.27   | $5.19       |
| 2024-07 | 268          | $65.29        | $10.03  | $55.26      |
| 2024-06 | 72           | $21.97        | $3.56   | $18.40      |
| 2024-05 | 233          | $231.57       | $36.24  | $195.33     |
| 2024-04 | 141          | $110.19       | $20.39  | $89.80      |
| 2024-03 | 917          | $310.15       | $57.29  | $252.86     |
| 2024-02 | 1034         | $217.84       | $41.40  | $176.44     |
| 2024-01 | 402          | $81.43        | $15.60  | $65.84      |

    10534

$4225.20
$622.82
$3602.38
