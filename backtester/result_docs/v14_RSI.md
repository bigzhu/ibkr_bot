# v14_RSI

## 需求

用 RSI 优化网格策略:避免缓慢深套

RSI 在中性偏低区(30-45)时表示卖压渐增但无超卖反弹动力,继续 BUY 易均匀套牢.用 RSI 计数 + 阈值,能在连续 3-4 BUY 时"软刹车"

RSI 参数设置(1m 专属)

- 周期:9 期(快反应,滞后 <1m,适合高频网格).
- 阈值:
  - 超卖确认: <30(允许"抄底" BUY).
  - 中性下行警戒:30-50(风险区,减/暂停).
  - 转势恢复:>50(反弹信号,重启挂单).

规则设计(3 步渐进保护)

正常挂 BUY:DeMark 下跌 + RSI <50(下行空间足,但不极端).

连续 BUY 过滤:

暂停: filled_orders 中>=2次成交记录都是 BUY, 且 RSI 处于 30-70 之间, 那么暂停挂入 BUY 单.

RSI 出现超卖 <30 或者 反弹 >70, 才允许挂入 BUY 单

## 明确实现细节 (与需求方确认后整理)

- 连续统计范围: 仅针对同一 `symbol + timeframe` 的 `filled_orders` 成交记录检测最近连续 2 笔 BUY, 无时间窗口限制.
- 适用周期: 所有运行的 timeframe 都需要走该逻辑, 但 RSI 仍以对应 timeframe 的 K 线重算 (默认周期 9).
- 暂停处理: 命中"连续 2 BUY 且 RSI 落在 30-70"时本次直接中止 BUY, 抛出异常即可; 不额外记录状态.
- 解锁条件: RSI <30 或 >70 时允许恢复下单; 或最近成交出现 SELL 导致不再满足"连续 BUY".连续 BUY 计数不需要手动归零.
- 集成方式: 保留既有 BUY 判定流程, 在决策末尾追加上述校验; 抛出的异常会沿用现有日志/告警机制.RSI 与 ATR 的开关统一在 `order_builder/feature_flags.py` 中维护.
- SELL 价格: 以最新蜡烛 low 为基础, 再减去 1 倍 ATR(7) 扩大回撤空间, 可通过 `ATR_SELL_PULLBACK_ENABLED` 调整.

## 测试

### 原始 0.1; 0.4; 及时 SELL 和 BUY

小波动也吃, 大的也可以吃到

6560.995550

| Month   | Transactions | Gross Revenue | Fees    | Net Revenue |
| ------- | ------------ | ------------- | ------- | ----------- |
| 2025-09 | 260          | $18.82        | $4.93   | $13.89      |
| 2025-08 | 2194         | $258.69       | $63.00  | $195.69     |
| 2025-07 | 2002         | $234.07       | $57.59  | $176.47     |
| 2025-06 | 1250         | $100.23       | $25.11  | $75.12      |
| 2025-05 | 1901         | $190.59       | $49.38  | $141.22     |
| 2025-04 | 1639         | $189.28       | $39.52  | $149.76     |
| 2025-03 | 2510         | $802.46       | $106.10 | $696.36     |
| 2025-02 | 2673         | $461.36       | $89.23  | $372.13     |
| 2025-01 | 3447         | $462.32       | $113.79 | $348.53     |
| 2024-12 | 3853         | $739.15       | $158.06 | $581.09     |
| 2024-11 | 4089         | $1071.95      | $231.28 | $840.67     |
| 2024-10 | 922          | $77.05        | $18.12  | $58.94      |
| 2024-09 | 919          | $74.19        | $17.09  | $57.10      |
| 2024-08 | 1334         | $179.07       | $33.29  | $145.78     |
| 2024-07 | 1409         | $136.74       | $33.16  | $103.59     |
| 2024-06 | 946          | $98.58        | $23.53  | $75.05      |
| 2024-05 | 1317         | $114.09       | $28.68  | $85.41      |
| 2024-04 | 2373         | $347.89       | $80.04  | $268.85     |
| 2024-03 | 4135         | $590.80       | $161.37 | $429.42     |
| 2024-02 | 2877         | $305.55       | $91.29  | $214.25     |
| 2024-01 | 2044         | $654.81       | $115.43 | $539.38     |

    44108

$7108.21
$1540.16
$5568.05

如果考虑手续费能返接近一半的话, 这个策略最好. 收益能达到 6000 多了

### 全 False

2024-01 1910
$645.29
$108.87
$536.42

### ATR_SELL_PULLBACK_ENABLED = True

套住: 6584.860880

2024-01 1615
$681.45
$101.25
$580.19

第一个月获得了突破, 看看多跑一段时间的效果

第二个月变低了214.25->207.95, 轻微

429.42->420.46

| Month   | Transactions | Gross Revenue | Fees    | Net Revenue |
| ------- | ------------ | ------------- | ------- | ----------- |
| 2024-11 | 2756         | $946.93       | $148.14 | $798.79     |
| 2024-10 | 774          | $75.21        | $15.96  | $59.25      |
| 2024-09 | 752          | $72.92        | $14.50  | $58.42      |
| 2024-08 | 1057         | $156.06       | $26.97  | $129.08     |
| 2024-07 | 1144         | $135.31       | $27.46  | $107.84     |
| 2024-06 | 776          | $94.33        | $19.27  | $75.05      |
| 2024-05 | 1018         | $102.91       | $22.87  | $80.04      |
| 2024-04 | 1894         | $341.14       | $65.39  | $275.74     |
| 2024-03 | 3069         | $538.17       | $117.71 | $420.46     |
| 2024-02 | 2162         | $276.21       | $68.26  | $207.95     |
| 2024-01 | 1615         | $681.45       | $101.25 | $580.19     |

很遗憾, 更宽的回撤空间, 也没有带来更高利润, 11 月反而更少了, 798

### BUY_FROM_COMPARE_KLINES=True

5557.152170

| Month   | Transactions | Gross Revenue | Fees    | Net Revenue |
| ------- | ------------ | ------------- | ------- | ----------- |
| 2025-09 | 253          | $19.42        | $4.77   | $14.66      |
| 2025-08 | 2014         | $235.01       | $53.45  | $181.56     |
| 2025-07 | 1843         | $203.38       | $47.26  | $156.13     |
| 2025-06 | 1114         | $91.13        | $21.00  | $70.13      |
| 2025-05 | 1745         | $176.78       | $42.97  | $133.81     |
| 2025-04 | 1476         | $176.87       | $34.19  | $142.67     |
| 2025-03 | 2310         | $696.52       | $83.94  | $612.58     |
| 2025-02 | 2453         | $372.48       | $69.50  | $302.99     |
| 2025-01 | 3194         | $409.22       | $95.97  | $313.25     |
| 2024-12 | 3591         | $651.00       | $133.45 | $517.55     |
| 2024-11 | 3823         | $859.95       | $176.54 | $683.41     |
| 2024-10 | 830          | $71.97        | $15.99  | $55.98      |
| 2024-09 | 817          | $68.59        | $14.80  | $53.79      |
| 2024-08 | 1212         | $150.67       | $27.06  | $123.62     |
| 2024-07 | 1257         | $121.69       | $27.08  | $94.61      |
| 2024-06 | 813          | $81.50        | $17.51  | $63.99      |
| 2024-05 | 1151         | $101.29       | $23.82  | $77.47      |
| 2024-04 | 2188         | $264.20       | $58.93  | $205.27     |
| 2024-03 | 3820         | $482.24       | $123.25 | $358.99     |
| 2024-02 | 2612         | $249.72       | $72.12  | $177.60     |
| 2024-01 | 1883         | $483.77       | $80.11  | $403.67     |

最终收益是 $4743.73

手续费 $1223.71

占住资金减少 1000 收益也减少了 1000
