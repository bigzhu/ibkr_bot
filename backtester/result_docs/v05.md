# v5 版本思路

1. 只做 1m 区间

## BUY

1. 满足 demark 信号且满足下跌百分比可以挂单(更谨慎的入场条件)
2. 下跌百分比触碰极值, 可以挂单(抓住突然的暴跌)

## SELL

1. 满足 demark 信号, 以最低 0.2 利润挂单, 不满足时候, 以 "最小利润百分比触发挂单" (及时跑路)
2. 上涨百分比触碰极值, 可以挂单 (不要错过突然的暴涨)

## 资金管理

1. 套住资金越多, 投入资金越少(尽量延长游戏时间, 限定最大套入金额)

## 利润来源

1. demark 信号高低差(每日少量收益)
2. 捕捉突然的价格跳变(较大利润)

## 核心参数确定

### 下跌百分比对应投资金额

max_buy_amount_period/25 就是每跌去 1% 需要投入的金额

max_buy_amount_period=1000 那么从 0.8 跌到 0.2, 大约会投入 5520 美元

## 已知限制

- 当前仍依赖 DeMark 信号给出 BUY/SELL 方向, 暂未实现当信号为 `NONE` 时的应急行情判断, 后续版本再完善.

## 数据回测

`backtester/clean_and_run.sh --start 2024-03-14 --end 2024-10-14 ADAUSDC 1m 10000`

### 入场测试

#### 利润 1.4% 入场 0.4% 逃离 0.4%

3833

$842.06
$162.73
$679.33

#### 利润 1.4% 入场 1.4% 逃离 0.4%

3873

$846.41
$161.51
$684.89

区别不大, 利润稍微多了一点点, 应该是入场点位更好导致的

#### 利润 1.4% 入场 2.4% 逃离 0.4%

3719

1193
$847.61
$161.29
$686.33

套住资金减少了, 利润还高了

资金沉淀到下方, 让格子变稀疏, 单格资金量提高

#### 利润 1.4% 入场 3.4% 逃离 0.4%

3704

881
$796.66
$149.95
$646.72

套住资金减少了, 交易笔数减少, 收益减少

#### 利润 1.4% 入场 4.4% 逃离 0.4%

3686

790
$893.45
$169.26
$724.19

套住资金减少了, 交易笔数减少, 利润大幅增加

#### 利润 1.4% 入场 5.4% 逃离 0.4%

3551

560
$736.59
$141.94
$594.65

套住资金减少了, 收益也大幅减少了, 即便是在这种下跌行情中, 也很难及时入场, 毕竟要求太苛刻了.

#### 2年回测 利润 1.4% 入场 4.4% 逃离 0.4%

3701.78

    2646

$3273.55
$564.10
$2709.46

大幅上涨, 基本抓不住利润, 下跌也能扛得住, 并且资金占用不多. 这个策略适合拉长周期放里面. 2000 块日息3块, 年化 50% 是肯定能达到的.

按照以前的占用 18000 资金的模式来折算, 利润对应13174.05, 不高但是稳, 暴跌心中都不慌.

#### 2年回测 利润 1.4% 入场 2.4% 逃离 0.4%

3742.114580

    4157

$3294.54
$571.00
$2723.54

除了交易数量大幅增加, 其他变化微乎其微, 利润还稍微高了一点

#### 2年回测 利润 1.4% 入场 1.4% 逃离 0.4%

3774

    5970

$3355.36
$584.46
$2770.89

时间周期拉长, 反而这个参数利润更高, 超过 4.4%

#### 2年回测 利润 1.4% 入场 1% 逃离 0.4%

3764.153220

    7127

$3335.31
$582.60
$2752.71

差异非常非常小, 为什么.........

### 利润测试

#### 利润 2.4% 入场 1.4% 逃离 0.4%

3873

$823.98
$156.19
$667.79

利润反而减少了

#### 利润 3.4% 入场 1.4% 逃离 0.4%

3870

1672
$814.94
$154.49
$660.45

全靠 demark 信号达到卖出, 影响不是特别大

利润百分比配置似乎可以做成暴涨的抓手

#### 利润 1% 入场 1.4% 逃离 0.4%

3683

1808
$832.05
$167.73
$664.32

交易数量暴增, 要放大周期测试了, 半年看不出差异

## 总结

### 利润 1.4% 入场 4.4% 逃离 0.4%

3701.78

    2646

$3273.55
$564.10
$2709.46

接近两年套住和收益.

1. 最大套住折算为 4000
2. 收益打满2年应该能到 3000

以 1000$ 为一个单位, 平均收益1个单位1天是 4$

#### 稳妥方案:

拿出手头资金的 1/4, 假如有 30w, 7.5w/1000 = 75 个单位, 每天期望收益 75\*4=300$

#### 激进方案:

最大套住币价跌去一半了, 币价再跌去一半的可能性很少, 再考虑获利资金复用, 多币种资金复用等情况.

拿出手头资金的 1/2, 假如有 30w, 15w/1000 = 150 个单位, 每天预期收益 150\*4=600$

最大的问题是, 目前资金大多套在 ada 上, 借贷要考虑 ada 下跌别平仓, 即便激进方案也只能用 80 个单位, 一旦币价跌一半, 损失所有 ada, 手里拿了一堆高位接盘的币. 价值缩水为 1/4

相当于加了 2 倍杠杆.

# 程序修改后重新测试

## 修改内容

1. SELL, BUY 单百分比变化超过配置的2倍, 跳过 demark 信号检查, 倍数也是一个可以调整的参数
2. 去掉 SELL 单的 demark 信号达标就按 0.4 变化售出的特殊处理

## 测试

### 直接入场倍数测试

#### 2年回测 利润 1.4%; 入场 1.4%; 2 倍直接入场

3992.815920

    3477

$4420.66
$335.95
$4084.71

获利大幅突破, 还是必须要捕捉剧烈波动行情

#### 2年回测 利润 1.4%; 入场 1.4%; 3 倍直接入场

3783.755740

    3220

$4287.99
$317.66
$3970.33

区别不大, 获利还稍微少了点

#### 2年回测 利润 1.4%; 入场 1.4%; 2 倍直接入场(重新用5137获利规则和参数测试)

5275.213830

    2693

$5446.74
$421.91
$5024.83

没有显著提升, 说明还是 1.44 入场更好

#### 2年回测 利润 1.4%; 入场 1.4%; 3 倍直接入场(重新用5137获利规则和参数测试)

5031.018280

    2356

$5132.39
$380.29
$4752.09

### 出入百分比测试

其实类似放大格子间距了

#### 2年回测 利润 1.4%; 入场 1.4%; 2 倍直入

3992.815920

    3477

$4420.66
$335.95
$4084.71

获利大幅突破, 还是必须要捕捉剧烈波动行情

#### 2年回测 利润 2.4%; 入场 2.4%; 2 倍直入

3765.526010

    1516

$4175.04
$215.10
$3959.95

交易次数大幅减少, 收益反而低了, 不选择

#### 2年回测 利润 1%; 入场 1%; 2 倍直入

尝试降低入场百分比, 来放大 demark 的作用

3792.564790

    5412

$4372.74
$414.30
$3958.44

收益区别不大, 但是手续费如果能回流一半, 还是划算用这种高频交易

#### 2年回测 利润 0.6%; 入场 0.6%; 2 倍直入

4059.908550

    10583

$4547.27
$595.21
$3952.07

如果算上手续费返利的话, 这个更划算了

#### 2年回测 利润 0.2%; 入场 0.2%; 10 倍直入

释放 demark 的力量

3889.371810

    13211

$4548.64
$737.22
$3811.42

考虑手续费能返一半的话, 这反而最划算了

#### 2年回测 利润 0.44%; 入场 0.44%; 4 BUY 2 SELL

3836.805770

    14256

$4633.66
$764.29
$3869.37

#### 2年回测 利润 1.44%; 入场 1.44%; 1.44 倍直入

3732.798530

    3891

$4495.53
$355.86
$4139.67

# 入场金额根据套住金额增加衰减

## 需求

实现投入资金根据套住资金衰减

需要添加一个入场金额系数的计算函数:

1. 获取 get_unmatched_value_by_timeframe
2. 获取 symbol_timeframe_config.max_buy_amount_period

系数为 get_unmatched_value_by_timeframe 的值除除以symbol_timeframe_config.max_buy_amount_period, 限定这个值x最小为1

而后用这个值乘以 14, 就得到系数 entry_coefficient

每个百分比的变化, 入场金额就是

```python

```

    entry_coefficient = calculate_entry_amount_coefficient(symbol, timeframe, max_buy_amount)
    one_percent_amount = max_buy_amount / entry_coefficient

```

```

## 测试

#### 2年回测 利润 1.44%; 入场 1.44%; 1.44 倍直入; 14 资金系数

3542.183670

    3891

$4972.01
$357.80
$4614.21

第一单就多贡献了 500, 去掉所以其实和之前差不多, 但是资金的分布更合理一些, 套住资金也变少了

#### 2年回测 利润 1.44%; 入场 1.44%; 1.44 倍直入; 24 资金系数

减少资金占用, 收益也少了, 但更能抓住持续上涨趋势

2623.633480

    3891

$3513.28
$262.81
$3250.46

#### 2年回测 利润 1.44%; 入场 1.44%; 1.44 倍直入; 7 资金系数(去掉2023年突变数据)

5221.550120

    3833

$5475.89
$493.94
$4981.94

去掉突变数据都能拉到 5k的收益, 简直无敌了

#### 2年回测 利润 1.44%; 入场 1.44%; 1.44 倍直入; 14 资金系数(去掉2023年突变数据)

3529.770760

    3833

$3707.19
$334.02
$3373.17

# demark 信号满足就按 0.2 出入(跑得快)

1. demark 满足就按 0.2% 出入
2. 变化达到 %2 也可出入

## 测试

### 2年回测 利润 1.44%; 入场 1.44%; 1.44 倍直入; 0.2 demark 出入; 7 资金系数(去掉2023年突变数据)

5326.653090

    13056

$5855.61
$1003.61
$4852.00

看来"跑得快"没什么用, 最大套住金额反而还增加了

少了100$收益, 但是如果手续费能返回一半, 那就很划算了

### 2年回测 利润 1.44%; 入场 1.44%; 1.44 倍直入; 0.2 demark 出入; 7 资金系数(去掉2023年突变数据); 跑得快入的慢 有demark信号也不入

5120.924950

    7932

$5807.23
$984.23
$4823.00

单方面跑得快没啥用, 套住金额变多, 收益还少了, 手续费也没变多, 应该是错失了很多机会

# demark 调整

最佳参数还是 利润 1.44%; 入场 1.44%; 1.44 倍直入; 7 资金系数; 10 demark

5092.037920

    3669

$5576.78
$494.64
$5082.14

demark 9->10 竟然让收益提升了

改成 11 试试

2024 年收益

5225.882580

    3508

$5586.43
$485.18
$5101.25

收益又上升了, 简直了这个. demark 的威力难道是体现在这里的

改成 12 竟然还能上升
5082.502900

    3264

$5610.98
$473.39
$5137.60

改成 13

5204.311520

    3090

$5591.64
$463.96
$5127.68

并没有提升, 反而还减少了, 还是 12 最优

入场倍数有可能会让 demark 无效化, 需要增加 2.44

5086.788740

    2469

$5304.45
$398.36
$4906.10

增加后, 效果很差

# 重新测试

1. 投入资金根据套住资金衰减
2. 2.44% 变化, 跳过 demark
3. 满足 demark 12, 0.44% 变化即可买卖

# 总结

各种参数其实区别不大, 仅是按百分比设定入场金额的实时挂单网格. demark 实质上也没起到什么作用

demark 对利润的影响非常小

最佳参数还是 利润 1.44%; 入场 1.44%; 1.44 倍直入; 7 资金系数; 12 demark

5082.502900

    3264

$5610.98
$473.39
$5137.60

获利最高

## 资金系数

如果是持续上涨行情, 那么 7 资金系数在资金利用率更高, 收益更高.

如果是波动, 那么 14 资金系数相对收益来说更划算.
